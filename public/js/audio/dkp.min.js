/*! dkp 2015-11-02 */
function getCookie(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):void 0}function setCookie(name,value,props){props=props||{};var exp=props.expires;if("number"==typeof exp&&exp){var d=new Date;d.setTime(d.getTime()+1e3*exp),exp=props.expires=d}exp&&exp.toUTCString&&(props.expires=exp.toUTCString()),value=encodeURIComponent(value);var updatedCookie=name+"="+value;for(var propName in props){updatedCookie+="; "+propName;var propValue=props[propName];propValue!==!0&&(updatedCookie+="="+propValue)}document.cookie=updatedCookie}function deleteCookie(name){setCookie(name,null,{expires:-1})}function isCookieEnabled(){document.cookie="testcookie";var cookieEnabled=-1!=document.cookie.indexOf("testcookie")?!0:!1;return cookieEnabled}var doc=document.documentElement;doc.setAttribute("data-useragent",navigator.userAgent);var d=new Date,clientTZOffset=-d.getTimezoneOffset();setCookie("clientTZOffset",clientTZOffset,{expires:2592e3,path:"/"}),serverTZoffset!=clientTZOffset&&isCookieEnabled()&&window.location.hostname==currentDomain&&location.reload(),$(document).ready(function(){function gridMove($obj,sign){parseInt($obj.data("current"))+sign>=0&&parseInt($obj.data("current"))+sign<$obj.children().length&&($obj.removeClass("shift-"+$obj.data("current")),$obj.data("current",parseInt($obj.data("current"))+sign),$obj.addClass("shift-"+$obj.data("current")))}function rightSlide(e){if(!isAnimating){isAnimating=!0,void 0!=e&&clearInterval(slideInterval),$(".dkp-slideshow").first().removeClass("dkp-moving-left"),$(".dkp-slideshow").first().addClass("dkp-moving-right");var prevIndex=currentSlide;setTimeout(function(){Modernizr.csstransitions?$(slides[prevIndex]).addClass("slide-left"):$(slides[prevIndex]).animate({left:"-100%"},500,function(){$(slides[prevIndex]).addClass("slide-left"),$(slides[prevIndex]).removeAttr("style")})},60),currentSlide<slides.length-1?currentSlide++:currentSlide=0,$(slides[currentSlide]).hasClass("slide-left")&&$(slides[currentSlide]).removeClass("slide-left"),$(slides[currentSlide]).hasClass("slide-right")||$(slides[currentSlide]).addClass("slide-right"),setTimeout(function(){Modernizr.csstransitions?($(slides[currentSlide]).removeClass("slide-right"),setTimeout(function(){isAnimating=!1},500)):$(slides[currentSlide]).animate({left:"0"},500,function(){$(slides[currentSlide]).removeClass("slide-right"),$(slides[currentSlide]).removeAttr("style"),isAnimating=!1})},50)}}function leftSlide(e){if(!isAnimating){isAnimating=!0,void 0!=e&&clearInterval(slideInterval),$(".dkp-slideshow").first().addClass("dkp-moving-left"),$(".dkp-slideshow").first().removeClass("dkp-moving-right");var prevIndex=currentSlide;setTimeout(function(){Modernizr.csstransitions?$(slides[prevIndex]).addClass("slide-right"):$(slides[prevIndex]).animate({left:"100%"},500,function(){$(slides[prevIndex]).addClass("slide-right"),$(slides[prevIndex]).removeAttr("style")})},60),currentSlide>0?currentSlide--:currentSlide=slides.length-1,$(slides[currentSlide]).hasClass("slide-right")&&$(slides[currentSlide]).removeClass("slide-right"),$(slides[currentSlide]).hasClass("slide-left")||$(slides[currentSlide]).addClass("slide-left"),setTimeout(function(){Modernizr.csstransitions?($(slides[currentSlide]).removeClass("slide-left"),setTimeout(function(){isAnimating=!1},500)):$(slides[currentSlide]).animate({left:"0"},500,function(){$(slides[currentSlide]).removeClass("slide-left"),$(slides[currentSlide]).removeAttr("style"),isAnimating=!1})},50)}}$(".dkp-day-back").each(function(){$(this).on("click",function(e){var $obj=$(e.target).siblings(".dkp-grid-day").find(".dkp-grid-custom-column");gridMove($obj,-1)})}),$(".dkp-day-forward").each(function(){$(this).on("click",function(e){var $obj=$(e.target).siblings(".dkp-grid-day").find(".dkp-grid-custom-column");gridMove($obj,1)})}),document.onkeydown=function(e){e=e||window.event,27==e.keyCode&&$().closeAnounce()},$.fn.closeModal=function(e){e.target===$("#dkp-anouncefull-wrapper")[0]&&$().closeAnounce(),e.target===$("#dkp-anouncefull-close")[0]&&$().closeAnounce()},$("#dkp-anouncefull-wrapper").on("click",function(e){return $().closeModal(e),!0});var currentScroll=0;$.fn.showModal=function(newResponseText){-1!=navigator.userAgent.indexOf("MSIE 8.0")&&(newResponseText=newResponseText.replace(/\/fmt_87_/,"/fmt_71_")),$("#dkp-anouncefull").html(newResponseText),$("#dkp-anouncefull-close").on("click",function(e){return $().closeModal(e),!1});var diffWidth=$("body").innerWidth();currentScroll=$(document).scrollTop(),$(":root").addClass("dkp-opened-modal"),$("#dkp-anouncefull-wrapper").scrollTop(0),currentScroll>0&&$(":root").css("marginTop",-currentScroll+"px"),diffWidth=$("body").innerWidth()-diffWidth,$(":root").css("paddingRight",diffWidth+"px")},$.fn.changeModalContents=function(newResponseText){$("#dkp-anouncefull").html(newResponseText)},$.fn.openAnounce=function(e,id){if(void 0==id){for(var obj=e.target||e.srcElement;!$(obj).hasClass("dkp-grid-day-item")&&!$(obj).hasClass("dkp-anonce")&&$(obj)!==$(":root");)obj=obj.parentNode;id=$(obj).data("id")}window.location.hash="#announce-"+id;var r=new XMLHttpRequest;return r.open("GET","/announce/ajax/"+id,!0),r.timeout=1e4,r.setRequestHeader("Accept","text/html"),r.send(),$().showModal('<div class="dkp-loader"></div>'),r.ontimeout=function(){delete r},r.onerror=function(){delete r},r.onreadystatechange=function(){return 4==r.readyState?200!=r.status?void delete r:void $().changeModalContents(r.responseText):void 0},!1},$.fn.closeAnounce=function(){$(":root").removeClass("dkp-opened-modal"),$(":root").css("marginTop","0"),$(":root").css("paddingRight","0"),$("#dkp-anouncefull").removeClass("removed1"),$("#dkp-anouncefull").removeClass("removed2"),window.location.hash="",window.scrollTo(0,currentScroll)};var announceId=0;if(window.location.hash.length>10)var announceId=window.location.hash.slice(10);0==announceId&&"undefined"!=typeof $("#dkp-anouncefull").data("id")||$("#dkp-anouncefull").data("id")==announceId?$().showModal($("#dkp-anouncefull").html()):announceId>0&&$().openAnounce(null,announceId);var tsInitX,tsInitY,tsDiffX,tsDiffY,closingAnonce=!1;$("#dkp-anouncefull-wrapper").on("touchstart",function(e){tsInitX=e.originalEvent.touches[0].clientX,tsInitY=e.originalEvent.touches[0].clientY}),$("#dkp-anouncefull-wrapper").on("touchmove",function(e){tsDiffX=e.originalEvent.touches[0].clientX-tsInitX,tsDiffY=e.originalEvent.touches[0].clientY-tsInitY,closingAnonce||(Math.abs(tsDiffY)<$(window).width()/50?(tsDiffX<-$(window).width()/50&&$("#dkp-anouncefull").addClass("removed1"),tsDiffX>$(window).width()/50&&($("#dkp-anouncefull").removeClass("removed1"),$("#dkp-anouncefull").removeClass("removed2"))):($("#dkp-anouncefull").removeClass("removed1"),$("#dkp-anouncefull").removeClass("removed2")))}),$("#dkp-anouncefull-wrapper").on("touchend",function(e){closingAnonce||(Math.abs(tsDiffX)<$(window).width()/10||tsDiffX+tsInitX>tsInitX||Math.abs(tsDiffY)>Math.abs(tsDiffX)?($("#dkp-anouncefull").removeClass("removed1"),$("#dkp-anouncefull").removeClass("removed2")):($("#dkp-anouncefull").addClass("removed2"),closingAnonce=!0,setTimeout(function(){$().closeAnounce(),closingAnonce=!1},500),stop_player_work())),tsDiffX=null,tsDiffY=null,tsInitX=null,tsInitY=null});var movingGrid=!1;$(".dkp-grid-day").each(function(){$(this).on("touchstart",function(e){tsInitX=e.originalEvent.touches[0].clientX,tsInitY=e.originalEvent.touches[0].clientY}).on("touchmove",function(e){tsDiffX=e.originalEvent.touches[0].clientX-tsInitX,tsDiffY=e.originalEvent.touches[0].clientY-tsInitY}).on("touchend",function(e){if(!movingGrid&&Math.abs(tsDiffX)>$(window).width()/10){var $obj=$(this).find(".dkp-grid-custom-column");tsDiffX>0?gridMove($obj,-1):gridMove($obj,1)}movingGrid=!1,tsDiffX=null,tsDiffY=null,tsInitX=null,tsInitY=null})}),$(".dkp-slideshow").on("touchstart",function(e){tsInitX=e.originalEvent.touches[0].clientX,tsInitY=e.originalEvent.touches[0].clientY}).on("touchmove",function(e){tsDiffX=e.originalEvent.touches[0].clientX-tsInitX,tsDiffY=e.originalEvent.touches[0].clientY-tsInitY}).on("touchend",function(e){isAnimating||Math.abs(tsDiffX)>$(window).width()/50&&(tsDiffX>0?leftSlide(!0):rightSlide(!0)),tsDiffX=null,tsDiffY=null,tsInitX=null,tsInitY=null});var slides=$(".dkp-slide"),currentSlide=0,isAnimating=!1,slideInterval=setInterval(rightSlide,6e3);$("#dkp-slideshow-right").on("click",rightSlide),$("#dkp-slideshow-left").on("click",leftSlide),$("#channel_switch_toggler").on("click",function(){$("body").toggleClass("menu-opened")}),$(".dkp-anonce-grid a").first().on("click",function(e){var offsets=document.getElementById("dkp-grid-wrapper").getBoundingClientRect();$(":root").animate({marginTop:"-"+offsets.top+"px"}),setTimeout(function(){$(":root").css("marginTop","0"),$("#dkp-grid-wrapper")[0].scrollIntoView(top)},500)})}),jQuery(function($){function getJWPlaylistItem(image,sources,title,id,repository){"string"==typeof sources&&(sources=[{file:sources}]),repository||(repository="<promo>");var obj={image:image,sources:sources,title:title,mediaid:id,galabel:id+" - "+repository+" - "+title};return obj}function sendEvent(category,action,label){"undefined"!=typeof ga&&ga("send","event",category,action,label)}if("undefined"!=typeof jwplayer){jwplayer.key="7KLirOAcovCZuIUmpwnVNN8eHg/T045URJ36uQ==";var jwplayerInstances=[],options={abouttext:"(c) 2015 Первый канал. Всемирная сеть",aboutlink:"http://www.1tv.com/agreement",controls:!0,displaytitle:!1,displaydescription:!1,stretching:"fill",width:"100%",aspectratio:"16:9",ga:{idstring:"mediaid",label:"galabel"},autostart:!0};navigator.userAgent.match(/(iPad|iPhone|iPod);.*CPU.*OS 7_\d/i)&&(options.plugins={"/js/jw7ios7fix.js":{}}),navigator.userAgent.match(/(iPad|iPhone|iPod|Android|Windows Phone)/i)||$(document).on("click",".jwplayer-start",function(){var $this=$(this);$this.toggleClass("active");var toggle_val=$(this).hasClass("active");if(1==toggle_val){$this.text("Скрыть");var id=$this.attr("id"),playlistData=$this.data("playlist"),wrapperId=$this.data("wrapper"),vast=$this.data("vast"),playlist=[];if(jwplayerInstances[id]=jwplayer(wrapperId),playlistData&&playlistData.length>0){var playlistIndex,imagesServer=$this.data("image-server"),videoServer=$this.data("video-server");for(playlistIndex=0;playlistIndex<playlistData.length;++playlistIndex)playlist.push(getJWPlaylistItem(imagesServer+"/"+playlistData[playlistIndex].path,videoServer+"/"+playlistData[playlistIndex].video_path,playlistData[playlistIndex].title,playlistData[playlistIndex].id,playlistData[playlistIndex].repository))}else playlist=[getJWPlaylistItem($this.attr("poster"),$this.attr("href"),$this.text(),$this.data("video-id"),$this.data("video-repository"))];var newOptions=$this.data("options");newOptions||(newOptions={}),newOptions.playlist=playlist,"undefined"!=typeof vast&&(newOptions.advertising={client:"vast",admessage:"Видеоролик закончится через xx сек.",skipoffset:1,skiptext:"Пропустить",tag:vast});var instanceOptions={};jQuery.extend(instanceOptions,options,newOptions),jwplayerInstances[id].setup(instanceOptions),jwplayerInstances[id].on("play",function(o){var obj=this.getPlaylistItem();null!==obj&&void 0!==obj&&null!==obj.mediaid&&void 0!==obj.mediaid&&obj.mediaid>0&&sendEvent("JW Player Play Src",obj.galabel,window.location.href)}),jwplayerInstances[id].on("error",function(event){sendEvent("JW Player Errors",event.message,window.location.href)}),jwplayerInstances[id].on("adImpression",function(event){sendEvent("JW Player VAST","impression",event.tag)});var runOnce=!0;return jwplayerInstances[id].on("adTime",function(event){event.position>event.duration/2&&runOnce&&(runOnce=!1,sendEvent("JW Player VAST","midpoint",event.tag))}),jwplayerInstances[id].on("adClick",function(event){sendEvent("JW Player VAST","click",event.tag)}),jwplayerInstances[id].on("adComplete",function(event){sendEvent("JW Player VAST","complete",event.tag)}),jwplayerInstances[id].on("adSkipped",function(event){sendEvent("JW Player VAST","skipped",event.tag)}),!1}var id=$this.attr("id");return $this.text("Трейлер"),"undefined"!=jwplayerInstances[id]&&(jwplayerInstances[id].stop(),$(".jwplayer").css("display","none")),!1})}$(document).on("click","#dkp-anouncefull-close",function(){stop_player_work()}),$(document).click(function(data){$(data.target).closest("#dkp-anouncefull").length||stop_player_work()}),stop_player_work=function(){var $this=$(".jwplayer-start"),id=$this.attr("id");return $this.text("Трейлер"),"undefined"!=jwplayerInstances[id]&&"undefined"!=jwplayerInstances[id].stop&&(jwplayerInstances[id].stop(),$(".jwplayer").css("display","none")),!1}});